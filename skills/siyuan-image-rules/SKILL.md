---
name: siyuan-image-rules
description: 在思源笔记（SiYuan）里处理图片/截图的规则与可复现流程：读图（必须用子代理）、为图片撰写标题与介绍（alt/title/可见说明）、选择 Markdown 或 HTML 写入方式、并用 siyuan_* 工具回读验证与回滚。用于批量更新图片说明、插入新图片、或排查图片 alt/title 丢失/被规范化的问题。
---

# SiYuan 图片规则（读图/写入/验证）

## 目标优先级（先选一种“结果”）
1) 只要图片能显示：用原生图片块即可（`![](/assets/...)`）。
2) 需要“可见标题/介绍”：在图片前/后加文本块（标题 + 1–3 句介绍）。

## 读图（需要理解图片内容时必须做）
- 每张图片单独 `spawn_agent` 一个子代理；子代理只做“看图提取信息”，不调用工具、不再派生。
- 汇总后再写标题/介绍；不确定就标 `待验证`，并给下一步验证方法（必须可执行）。

## 标题与介绍怎么写（适用于 alt/title/可见说明）
- 标题（title）：说明“这张图是什么 + 用来说明什么”，不要用“截图1/图2”。
- 介绍（alt/可见说明）：1–3 句写清“关键内容 + 阅读重点 + 触发/上下文”，让看不到图的人也能复现/排障。
- 尽量具体：关键字段/按钮名/URL/错误码/时间点（如有）。

## 写入方式选择（MCP 写入建议）

### A) 原生图片块（显示最稳）
- 写入：`![](/assets/xxx.png)`（或通过导入/粘贴生成）。
- 说明：如果需要标题/介绍，另起一段文字写在图前/图后。

### B) Markdown 图片语法（可能被规范化）
- 目标格式：`![ALT](/assets/xxx.png "TITLE")`
- 已知坑（待验证但在本库多次复现）：当 `ALT/TITLE` 包含某些全角符号（例如 `（ ）`）时，通过 API 写入后可能被规范化为 `![](/assets/...)`，导致 `ALT/TITLE` 丢失。
- 规避：优先用半角 `()`；避免零宽字符；写入后立刻回读验证。

### C) HTML `<img>`（alt/title 最可控）
- 写入示例：`<img src="/assets/xxx.png" alt="..." title="..."/>`
- 适用：你要求“标题/介绍写在图片标题介绍里面”且要能回读保留时。
- 注意：编辑体验不同（HTML 块）。

## 最小验证（每次批量改图后至少做一次）
1) `siyuan_get_block_content` 用 `markdown` + `kramdown` 回读目标块（确认内容是否被规范化）。
2)（可选）SQL 查 `blocks.markdown` 是否含 `![` / `alt=` / `title=`。
3) 记录：通过/失败 + 关键输出（块 ID + 回读内容摘要）。

## 回滚（出问题时）
- 优先用 `siyuan_get_block_content` 先备份原内容，再用 `siyuan_update_block` 恢复。
- 删除实验块前先确认无引用；不要随意删除 assets 文件。
